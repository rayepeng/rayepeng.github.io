---
title: ä»ä¸€ä¸ªé—®é¢˜å¼•å‘çš„JSå†…å­˜æ¢ç´¢
published: 2023-08-28
description: ''
image: ''
tags: ['JS', 'ç¼–ç¨‹', 'v8', 'å†…å­˜']
category: 'ç¼–ç¨‹'
draft: false
lang: ''
---
 ä»ä¸€ä¸ªé—®é¢˜å¼•å‘çš„JSå†…å­˜æ¢ç´¢

æ ‡é¢˜å…¶å®ä¸å¤ªæ°å½“ï¼Œå…ˆè¿™æ ·å§



<!-- ![Group 1 (1)](./attachments/bafybeiarqugozxrfahcfgwqut56yrh4ycgrjhnkujij2jhw6glptvaj7fm.png) -->


 ä»ä¸€ä¸ªå†…å­˜è§„å¾‹è¯´èµ·

èµ·å› æ˜¯åœ¨ç ”ç©¶å¾®ä¿¡å°æ¸¸æˆçš„æ—¶å€™ï¼Œå‘ç°ç½‘ä¸Šä¸€ç›´æµä¼ ç€ä¸€ä¸ªè§„å¾‹ï¼Œå³æ¸¸æˆå†…æ•°å€¼ \* 2 = å†…å­˜æ•°å€¼

æ¯”å¦‚ï¼š[Â CEæ¸¸æˆå†…å­˜ä¿®æ”¹-çˆ±ç¥èŠ±å›­Â ](https://www.nowcoder.com/discuss/352819218934489088)

<!-- ![DraggedImage](./attachments/bafybeiaewaqfm2cnq3oo36svhgz2mx26kxc2jl27s5v3hh7evq7g23hy6a.png) -->

è¿™ä¸ªä¸¤å€ç¡®å®æœ‰ç‚¹ä»¤äººè´¹è§£ï¼ŒæŒ‰ç…§æˆ‘å¯¹ç¼–è¯‘åŸç†çš„ç†è§£ï¼Œä»£ç æœ€åå˜ä¸ºæ±‡ç¼–ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œè™½ç„¶ä¼šç»è¿‡å¸¸é‡æŠ˜å ç­‰æ“ä½œï¼Œä½†ä»£ç ä¸­æ•°å€¼æ˜¯å¤šå°‘ï¼Œå®é™…å†…å­˜ä¸­çš„æ•°å€¼ä¹Ÿå°±æ˜¯é‚£ä¸ªï¼Œæ¯”å¦‚æˆ‘ä»¬é€šè¿‡CEæ¥ä¿®æ”¹æ¤ç‰©å¤§æˆ˜åƒµå°¸ï¼Œä»£ç ä¸­å¹¶æœªå¯¹é˜³å…‰æ•°å€¼åšåŠ å¯†ï¼Œå› æ­¤ç›´æ¥æœç´¢æ•°å€¼å°±å¯ä»¥å®šä½åˆ°ï¼š
[Â [reå…¥é—¨]ceå¯¹æ¤ç‰©å¤§æˆ˜åƒµå°¸çš„ä¿®æ”¹Â ](https://blog.51cto.com/u_15302226/5189504)

å¦‚æœæ˜¯æ¸¸æˆåšäº†æ•°å€¼çš„å˜åŒ–è¿˜å¥½è¯´ï¼Œä½†æ˜¯å®é™…æ¸¸æˆä»£ç é‡Œæ˜¯å¹¶æœªå»åšè¿™ç±»æ“ä½œçš„ï¼ˆè¦åšè¿™ä¸ªæ“ä½œä¹Ÿä¸è‡³äºç®€å•åœ°åšä¸ª2å€ä¹˜æ³•å§ğŸ¤”ï¼‰

ç”±æ­¤ä½œä¸ºå› å­ï¼Œå¼€å§‹ç ”ç©¶JSçš„å†…å­˜é—®é¢˜


 v8å¼•æ“

æœ¬è´¨ä¸Šå¾®ä¿¡å°ç¨‹åºä»£ç ä¹Ÿæ˜¯è·‘åœ¨v8å¼•æ“ä¸Šçš„ï¼Œäºæ˜¯å¼€å§‹å¥½å¥‡JSä»£ç æ˜¯æ€ä¹ˆä¸€æ­¥æ­¥å˜ä¸ºæ±‡ç¼–ä»£ç çš„

æˆ‘ä»¥ä¸ºnode.jså°±æ˜¯v8ï¼Œæ¯•ç«Ÿnode.jsä¹Ÿæ˜¯åŸºäºv8ç§»æ¤çš„å˜›ï¼Œä½†å‘ç°ä¸¤è€…è¿˜æ˜¯æœ‰åŒºåˆ«çš„ã€‚v8 æœ¬èº«æ˜¯æä¾›äº†ä¸€ä¸ªshellçš„ï¼Œè¿™ä¸ªæ‰æ˜¯æœ€åŸæ±åŸå‘³çš„

æœ¬åœ°å¯ä»¥ç¼–è¯‘ä¸€ä¸ªv8 shell

æ­¥éª¤å‚è€ƒï¼š[https://gist.github.com/Becavalier/58da63744f255abe5717e23dacc673e5](https://gist.github.com/Becavalier/58da63744f255abe5717e23dacc673e5)

```bash
 ä¸‹è½½äºŒè¿›åˆ¶å·¥å…·
git clone https://chromium.googlesource.com/chromium/tools/depot_tools.git
export PATH=/path/depot_tools:$PATH
source ~/.bash_profile

 æ–°å»ºä¸€ä¸ªæƒ³è¦å®‰è£…v8çš„ç›®å½•
gclient

fetch v8
cd v8
gclient sync
tools/dev/v8gen.py x64.optdebug
ninja -C out.gn/x64.optdebug 

 æœ€åè·å¾—d8çš„å®‰è£…è·¯å¾„
/path/chromev8/v8/out.gn/x64.optdebug/d8
```

 v8 æ˜¯æ€ä¹ˆç¼–è¯‘æ‰§è¡ŒJSä»£ç çš„ï¼Ÿ

åŸºæœ¬åŸç†è¿˜æ˜¯é‚£å¥—ï¼Œè¯æ³•è§£æ-\>è¯­æ³•è§£æ-\>ä¸­é—´ä»£ç ç”Ÿæˆç­‰

ä¸è¿‡v8è¿˜åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œå³ `ignition` ä¸ `turbofan` ï¼Œä½†è¿™äº›éƒ½ä¸åœ¨æœ¬æ¬¡è®¨è®ºèŒƒå›´å†…

<!-- ![DraggedImage-1](./attachments/bafkreid2uqvx5ii53llefy77rnclbq4khhnlqyb2jeadzgwlbkj6eufmsi.png) -->


ä»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ€åçš„ç»“æœå°±æ˜¯ bytecodeï¼Œé‚£ä¹ˆè¿™ä¸ªbytecodeé•¿ä»€ä¹ˆæ ·å­ï¼Ÿ

å†™ä¸€æ®µä»£ç åšæµ‹è¯•ï¼š

```bash
function test( obj ) {
  return obj.money + 10;
}

class UserData {
  constructor( money, power ) {
    this.money = money;
    this.power = power;
  }
}
u = new UserData(50, 100);
console.log(u.money, u.power);
for(let i = 0; i < 100000000; i++){
  test( u );
}
```

æ‰“å°å­—èŠ‚ç  

```bash
d8  -print-bytecode test1.js 
```

æˆ‘è¿™é‡Œå°±æŠŠå®Œæ•´çš„å­—èŠ‚ç æ”¾ä¸Šæ¥äº†ï¼š

```bash
[generated bytecode for function:  (0x35e90011ae01 <SharedFunctionInfo>)]
Bytecode length: 131
Parameter count 1
Register count 7
Frame size 56
         0x35e90011afec @    0 : 13 00             LdaConstant [0]
         0x35e90011afee @    2 : c3                Star2
         0x35e90011afef @    3 : 19 fe f7          Mov <closure>, r3
         0x35e90011aff2 @    6 : 65 68 01 f8 02    CallRuntime [DeclareGlobals], r2-r3
         0x35e90011aff7 @   11 : 82 01             CreateBlockContext [1]
         0x35e90011aff9 @   13 : 1a f8             PushContext r2
         0x35e90011affb @   15 : 10                LdaTheHole
         0x35e90011affc @   16 : bf                Star6
         0x35e90011affd @   17 : 81 03 00 00       CreateClosure [3], [0], 0
         0x35e90011b001 @   21 : c2                Star3
         0x35e90011b002 @   22 : 13 02             LdaConstant [2]
         0x35e90011b004 @   24 : c1                Star4
         0x35e90011b005 @   25 : 19 f7 f5          Mov r3, r5
         0x35e90011b008 @   28 : 65 2a 00 f6 03    CallRuntime [DefineClass], r4-r6
         0x35e90011b00d @   33 : 1b f8             PopContext r2
         0x35e90011b00f @   35 : 0b f5             Ldar r5
         0x35e90011b011 @   37 : 25 02             StaCurrentContextSlot [2]
         0x35e90011b013 @   39 : 16 02             LdaCurrentContextSlot [2]
         0x35e90011b015 @   41 : c3                Star2
         0x35e90011b016 @   42 : 0d 32             LdaSmi [50]
         0x35e90011b018 @   44 : c2                Star3
         0x35e90011b019 @   45 : 0d 64             LdaSmi [100]
         0x35e90011b01b @   47 : c1                Star4
         0x35e90011b01c @   48 : 0b f8             Ldar r2
         0x35e90011b01e @   50 : 69 f8 f7 02 00    Construct r2, r3-r4, [0]
         0x35e90011b023 @   55 : 23 04 02          StaGlobal [4], [2]
         0x35e90011b026 @   58 : 21 05 04          LdaGlobal [5], [4]
         0x35e90011b029 @   61 : c2                Star3
         0x35e90011b02a @   62 : 2d f7 06 06       GetNamedProperty r3, [6], [6]
         0x35e90011b02e @   66 : c3                Star2
         0x35e90011b02f @   67 : 21 04 08          LdaGlobal [4], [8]
         0x35e90011b032 @   70 : c1                Star4
         0x35e90011b033 @   71 : 2d f6 07 0a       GetNamedProperty r4, [7], [10]
         0x35e90011b037 @   75 : c1                Star4
         0x35e90011b038 @   76 : 21 04 08          LdaGlobal [4], [8]
         0x35e90011b03b @   79 : c0                Star5
         0x35e90011b03c @   80 : 2d f5 08 0c       GetNamedProperty r5, [8], [12]
         0x35e90011b040 @   84 : c0                Star5
         0x35e90011b041 @   85 : 5f f8 f7 f6 f5 0e CallProperty2 r2, r3, r4, r5, [14]
         0x35e90011b047 @   91 : 0c                LdaZero
         0x35e90011b048 @   92 : c4                Star1
         0x35e90011b049 @   93 : 0e                LdaUndefined
         0x35e90011b04a @   94 : c5                Star0
         0x35e90011b04b @   95 : 01 0d 00 e1 f5 05 LdaSmi.ExtraWide [100000000]
         0x35e90011b051 @  101 : 6d f9 10          TestLessThan r1, [16]
         0x35e90011b054 @  104 : 9a 18             JumpIfFalse [24] (0x35e90011b06c @ 128)
         0x35e90011b056 @  106 : 21 09 11          LdaGlobal [9], [17]
         0x35e90011b059 @  109 : c3                Star2
         0x35e90011b05a @  110 : 21 04 08          LdaGlobal [4], [8]
         0x35e90011b05d @  113 : c2                Star3
         0x35e90011b05e @  114 : 62 f8 f7 13       CallUndefinedReceiver1 r2, r3, [19]
         0x35e90011b062 @  118 : c5                Star0
         0x35e90011b063 @  119 : 0b f9             Ldar r1
         0x35e90011b065 @  121 : 50 15             Inc [21]
         0x35e90011b067 @  123 : c4                Star1
         0x35e90011b068 @  124 : 8a 1d 00 16       JumpLoop [29], [0], [22] (0x35e90011b04b @ 95)
         0x35e90011b06c @  128 : 0b fa             Ldar r0
         0x35e90011b06e @  130 : aa                Return
Constant pool (size = 10)
0x35e90011af9d: [FixedArray] in OldSpace
 - map: 0x35e900000089 <Map(FIXED_ARRAY_TYPE)>
 - length: 10
           0: 0x35e90011ae71 <FixedArray[2]>
           1: 0x35e90011ae55 <ScopeInfo CLASS_SCOPE>
           2: 0x35e90011af79 <FixedArray[7]>
           3: 0x35e90011aebd <SharedFunctionInfo UserData>
           4: 0x35e900002b85 <String[1]: u>
           5: 0x35e9000044a9 <String[7]: console>
           6: 0x35e900311cad <String[3]: log>
           7: 0x35e90011adc5 <String[5]: money>
           8: 0x35e90011add9 <String[5]: power>
           9: 0x35e900310aed <String[4]: test>
Handler Table (size = 0)
Source Position Table (size = 0)
[generated bytecode for function: UserData (0x35e90011aebd <SharedFunctionInfo UserData>)]
Bytecode length: 14
Parameter count 3
Register count 0
Frame size 0
         0x35e90011b1f8 @    0 : 0b 03             Ldar a0
         0x35e90011b1fa @    2 : 32 02 00 00       SetNamedProperty <this>, [0], [0]
         0x35e90011b1fe @    6 : 0b 04             Ldar a1
         0x35e90011b200 @    8 : 32 02 01 02       SetNamedProperty <this>, [1], [2]
         0x35e90011b204 @   12 : 0e                LdaUndefined
         0x35e90011b205 @   13 : aa                Return
Constant pool (size = 2)
0x35e90011b1c9: [FixedArray] in OldSpace
 - map: 0x35e900000089 <Map(FIXED_ARRAY_TYPE)>
 - length: 2
           0: 0x35e90011adc5 <String[5]: money>
           1: 0x35e90011add9 <String[5]: power>
Handler Table (size = 0)
Source Position Table (size = 0)
50 100
[generated bytecode for function: test (0x35e90011ae81 <SharedFunctionInfo test>)]
Bytecode length: 8
Parameter count 2
Register count 0
Frame size 0
         0x35e90011b374 @    0 : 2d 03 00 01       GetNamedProperty a0, [0], [1]
         0x35e90011b378 @    4 : 44 0a 00          AddSmi [10], [0]
         0x35e90011b37b @    7 : aa                Return
Constant pool (size = 1)
0x35e90011b349: [FixedArray] in OldSpace
 - map: 0x35e900000089 <Map(FIXED_ARRAY_TYPE)>
 - length: 1
           0: 0x35e90011adc5 <String[5]: money>
Handler Table (size = 0)
Source Position Table (size = 0)
```


å¯¹äºåˆæ¬¡æ¥è§¦è¿™ä¸ªå­—èŠ‚ç çš„äººæ¥è¯´ï¼Œè‚¯å®šæ˜¯è¦èŠ±ç‚¹æ—¶é—´æ‰èƒ½ç†è§£æ¸…æ¥šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥ä¸¢ç»™chatGPTï¼Œçœ‹çœ‹å®ƒèƒ½ä¸èƒ½å¤åŸå‡ºåŸæ¥çš„ä»£ç ï¼š

> ä»¥ä¸‹å›ç­”å‡ºè‡ªGPT4

è¿™æ®µå­—èŠ‚ç è¡¨ç¤ºäº†ä¸€æ®µæ›´å¤æ‚çš„JavaScriptä»£ç ã€‚è®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥åœ°åˆ†æå®ƒã€‚

 ä¸»å‡½æ•°å­—èŠ‚ç 

 å¸¸é‡æ± ï¼š

1. å…¶ä»–å›ºå®šæ•°ç»„å’Œå…ƒæ•°æ®
2. ScopeInfo for Class (ç±»çš„èŒƒå›´ä¿¡æ¯)
3. å…¶ä»–å›ºå®šæ•°ç»„å’Œå…ƒæ•°æ®
4. `UserData` çš„å…±äº«å‡½æ•°ä¿¡æ¯
5. å­—ç¬¦ä¸² `u`
6. å­—ç¬¦ä¸² `console`
7. å­—ç¬¦ä¸² `log`
8. å­—ç¬¦ä¸² `money`
9. å­—ç¬¦ä¸² `power`
10. å­—ç¬¦ä¸² `test`

 åˆ†æï¼š

1. å®šä¹‰ä¸€ä¸ªç±»`UserData`ï¼Œå®ƒæœ‰ä¸¤ä¸ªå±æ€§ï¼š`money`å’Œ`power`ã€‚
2. åˆ›å»ºä¸€ä¸ª`UserData`å®ä¾‹ï¼Œä¼ å…¥å‚æ•° `50` å’Œ `100` ä½œä¸º `money` å’Œ `power` çš„åˆå§‹åŒ–å€¼ã€‚
3. å°†è¿™ä¸ªå®ä¾‹èµ‹å€¼ç»™å˜é‡ `u`ã€‚
4. è°ƒç”¨ `console.log(u.money, u.power)`ã€‚
5. åˆ›å»ºä¸€ä¸ªå¾ªç¯ï¼Œå¾ªç¯æ¬¡æ•°ä¸º`100000000`ï¼Œåœ¨å¾ªç¯å†…éƒ¨è°ƒç”¨å‡½æ•° `test`ï¼Œä½¿ç”¨ `u` ä½œä¸ºå‚æ•°ã€‚

 UserDataæ„é€ å‡½æ•°å­—èŠ‚ç 

 åˆ†æï¼š

1. è®¾ç½®`this.money`ä¸ºä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚
2. è®¾ç½®`this.power`ä¸ºä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚

 testå‡½æ•°å­—èŠ‚ç 

 åˆ†æï¼š

1. ä»ä¼ å…¥çš„å¯¹è±¡ä¸­è·å– `money` å±æ€§ã€‚
2. å°†è·å–åˆ°çš„å€¼åŠ 10ã€‚
3. è¿”å›è¿™ä¸ªç»“æœã€‚

 å¤åŸåçš„JavaScriptä»£ç ï¼š

```javascript
class UserData {
    constructor(money, power) {
        this.money = money;
        this.power = power;
    }
}

let u = new UserData(50, 100);
console.log(u.money, u.power);

function test(obj) {
    return obj.money + 10;
}

for (let i = 0; i < 100000000; i++) {
    test(u);
}
```

è¿™å°±æ˜¯æ ¹æ®ç»™å®šçš„å­—èŠ‚ç å¤åŸçš„JavaScriptä»£ç ã€‚

GPT4ä¹Ÿå¤ªç‰›äº†ğŸ¥¹ï¼Œå®Œç¾å–ä»£æˆ‘å§

æ•´ä½“çš„å­—èŠ‚ç è¿˜æ˜¯å¾ˆå¥½ç†è§£çš„ï¼Œå¤šçœ‹å‡ éï¼Œç»“åˆå¯¹åº”çš„æŒ‡ä»¤æ ¼å¼ä¸éš¾åˆ†æå‡ºæ¥ã€‚

å¹¶ä¸”å¯ä»¥çœ‹åˆ°è¿™ä¸¤æ¡æŒ‡ä»¤ï¼Œè¿™å°±å¾ˆç±»ä¼¼æ±‡ç¼–æŒ‡ä»¤é‡Œå»movä¸€ä¸ªæ•°å€¼ï¼Œæ‰€ä»¥è¿™ä¸ªæ•°å€¼ä¸€å®šæ˜¯åŸå°ä¸åŠ¨åœ°ä¿ç•™åœ¨å†…å­˜æ•°æ®é‡Œçš„

```javascript
         0x35e90011b016 @   42 : 0d 32             LdaSmi [50]

         0x35e90011b019 @   45 : 0d 64             LdaSmi [100]
```


å› ä¸ºv8è¿è¡Œæ—¶å¹¶æ²¡æœ‰ setInterval ï¼ˆä¹Ÿå¾ˆç¥å¥‡äº†ï¼‰ï¼Œäºæ˜¯ç›´æ¥åœ¨d8çš„shellé‡Œåšè¿™ä¸ªå®éªŒï¼š

å¯ä»¥å¾ˆæ¸…æ™°åœ°å®šä½åˆ°ï¼Œå†…å­˜æ•°å€¼å°±æ˜¯å®é™…è¿è¡Œæ—¶æ•°å€¼çš„ä¸¤å€ï¼ˆ2474 = 1237 \* 2ï¼‰

<!-- ![DraggedImage-2](./attachments/bafkreidnhzgcxooug3lcnwvmlbqrk6egcqcr35hwacwppnzpjyky5k4woq.png) -->


ä¿®æ”¹å†…å­˜ï¼Œæ­¤æ—¶çš„æ•°å€¼å°±ç›´æ¥å‘ç”Ÿå˜åŒ–äº†

<!-- ![DraggedImage-3](./attachments/bafkreieutfagqsew5zafzr5342fdyudipo3pgy2vt2tc2mtljfj4xqoogq.png) -->


 å¯¹æ¯”node.js

æ—¢ç„¶å¦‚æ­¤ï¼Œé‚£å°±æ¥çœ‹çœ‹node.js

 è‡ªå®šä¹‰çš„ç±»

åŒæ ·çš„ä»£ç ï¼Œåœ¨node.jsçš„shellä¸­è¿è¡Œï¼Œå®ä¾‹åŒ–ä¸€ä¸ªå¯¹è±¡ userï¼Œå¯ä»¥çœ‹åˆ°æˆ‘è®¾ç½®äº† user.money ä¸ºä¸€ä¸ªå¾ˆå¥‡æ€ªçš„æ•°å€¼ï¼Œç›®çš„æ˜¯ä¿è¯å†…å­˜ä¸­ä¸ä¼šå‡ºç°é‡å¤çš„æ•°å€¼ï¼ˆè™½ç„¶è¿˜æ˜¯é‡å¤äº†ä¸‰ä¸ªï¼‰
é‚£å°±å°†è¿™ä¸‰ä¸ªæ•°å€¼éƒ½ä¿®æ”¹äº†ï¼Œæ•ˆæœä¹Ÿå¾ˆæ˜æ˜¾ï¼Œä¿®æ”¹å®Œä¹‹åï¼Œuser.money çš„æ•°å€¼å°±å˜åŒ–äº†

é‚£ä¹Ÿä¸å­˜åœ¨ä»€ä¹ˆä¸¤å€å…³ç³»å•Šï¼ŸğŸ¤” è¿™ä¸æ˜¯å¾ˆæ­£å¸¸çš„ï¼Œå®šä½åˆ°æ•°å€¼åç›´æ¥ä¿®æ”¹å°±å¥½äº†

<!-- ![DraggedImage-4](./attachments/bafybeieagaloceax56ptto53amql453tq7wur6td2qpsbgxgv7776fomum.png) -->

<!-- ![DraggedImage-5](./attachments/bafybeih5ei6q2bh6r3madhytk65u32zlijqbrtpjeuouddl3ugdgkme4nq.png) -->



 å†…ç½®çš„ç±»

è‡ªå®šä¹‰çš„ç±»ï¼Œå¯¹åº”çš„æ•°å€¼æ˜¯å¯ä»¥ç›´æ¥æœç´¢åˆ°çš„ï¼Œé‚£ä¹ˆnode.jsæä¾›çš„ç±»ä¼šä¸ä¼šä¸ä¸€æ ·å‘¢ï¼Œæ‰¾ä¸ªMapåšä¸‹æµ‹è¯•

```javascript
class UserData {
    constructor(money, power) {
        this.test_map =new Map();
        this.test_map.set('money', money);
        this.test_map.set('power', power);
    }
}
```


é€šè¿‡CEè¿˜æ˜¯å¯ä»¥å®šä½åˆ°ï¼š

<!-- ![DraggedImage-6](./attachments/bafkreihw4kycqllv27lg4m35pvvi6vhtltp4niydrnyntz55wh4t5s6fcm.png) -->


å¹¶ä¸”ä¹Ÿèƒ½ä¿®æ”¹ï¼š

<!-- ![DraggedImage-7](./attachments/bafkreiaudyut4wv7kl657bahdt5sh5c7fyze2hfzwsx6kqvav7k7z2b5pe.png) -->


 å¯¹æ¯”æµè§ˆå™¨

åçŸ¥åè§‰ï¼Œæ‰æ„è¯†åˆ°chromeçš„å¼€å‘è€…å·¥å…·ä¸­æœ‰ä¸€ä¸ªå¯ä»¥æ‹æ‘„å†…å­˜å¿«ç…§çš„å·¥å…·ï¼Œä¸»è¦æ˜¯ç”¨æ¥æ’æŸ¥å†…å­˜æ³„æ¼åŸå› çš„ï¼Œä¸è¿‡å¯¹äºå†…å­˜å¸ƒå±€çš„ç ”ç©¶ä¹Ÿå¾ˆæ–¹ä¾¿

 chrome Memoryé¢æ¿

æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€æ®µç¤ºä¾‹ä»£ç ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    
</body>
<script>
var _____testArray_____ = [{value: 'hello'}, {money: 9999} ];
console.info(_____testArray_____);
</script>
</html>
```

æ‹æ‘„å†…å­˜å¿«ç…§ï¼Œç‚¹å‡»è·å–å¿«ç…§å³å¯æ‹æ‘„ä¸‹å½“å‰çš„å¿«ç…§

<!-- ![DraggedImage-8](./attachments/bafkreia77nqgdycbax65lm2ui33fbox6opizblkhf7hmn3at3orxrye3om.png) -->


åœ¨å½“å‰é¡µé¢ç›´æ¥æŒ‰ä¸‹ `cmd + F` (å¯¹åº”Windowsåº”è¯¥æ˜¯ `ctfl+ F` ï¼Œå¯ä»¥åœ¨åº•éƒ¨æ‰“å¼€æœç´¢çª—å£

å› ä¸ºæˆ‘ä»¬çš„ä»£ç ä¸­å‡ºç°äº† `hello` å­—ç¬¦ä¸²ï¼Œå› æ­¤ç›´æ¥æœç´¢ä¹‹ï¼Œæœåˆ°ä¹‹åï¼Œå³é”®åœ¨æ‘˜è¦è§†å›¾ä¸­æ˜¾ç¤ºï¼Œå°±å¯ä»¥å®šä½åˆ°å¯¹åº”çš„æ„é€ å‡½æ•°äº†


<!-- ![DraggedImage-9](./attachments/bafybeiawiyqaqg6zhjj2r3nszkf2guprtqf5qplc5iqhwgjdt3gk5hhv5q.png) -->



ä»å†…å­˜ç»“æ„ä¸Šçœ‹ï¼Œ 

å³ï¼š
- hello å­—ç¬¦ä¸² @17037ï¼ˆå¯ä»¥ç†è§£ä¸ºä¸€æ®µå†…å­˜çš„æ ‡è¯†ç¬¦ï¼‰
	- å­˜å‚¨åœ¨ Object@92971 ï¼ˆå¯¹åº” `{value: ;'hello'}`ï¼‰
		- Objåˆä½œä¸ºæ•°ç»„ï¼Œå­˜å‚¨åœ¨ Array@92961ï¼ˆå¯¹åº” `[{value: 'hello'} ]`)
			- æ•°ç»„å­˜å‚¨åœ¨ `testArray`è¿™ä¸ªå˜é‡ä¸­ï¼Œç”±äºæ˜¯å…¨å±€å˜é‡ï¼Œå› æ­¤å¯¹åº”åˆ° Window@92867 ä¸Š

> è¿™ä¹Ÿå¯¹åº”äº†é€šè¿‡ var å£°æ˜çš„å˜é‡æ˜¯ç›´æ¥æŒ‚è½½åœ¨ Windowå¯¹è±¡çš„å±æ€§ä¸Š

 ä»€ä¹ˆæ˜¯smiï¼Ÿ

å¦‚æœä½ è¶³å¤Ÿçœ¼å°–ï¼Œåº”è¯¥å°±èƒ½å‘ç°ï¼Œæ•°å­—9999è¢«æ ‡è®°ä¸Šäº†smi number

<!-- ![DraggedImage-10](./attachments/bafkreifrt7vjy4mshwgr36kxw5ufcwqq7yxwfrsgjyuta6ie27xay5lkye.png) -->



> ä»¥ä¸‹æ˜¯GPT4ç»™å‡ºçš„å›ç­”ï¼š
> åœ¨ JavaScript çš„ V8 å¼•æ“ï¼ˆä¸»è¦ç”¨äº Google Chrome å’Œ Node.jsï¼‰ä¸­ï¼ŒSMIï¼ˆSmall Integerï¼‰æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ•´æ•°è¡¨ç¤ºæ–¹å¼ã€‚è¿™ç§è¡¨ç¤ºæ–¹æ³•ä¸»è¦ç”¨äºæ€§èƒ½ä¼˜åŒ–ã€‚SMI æ˜¯ä¸€ç§â€œæ ‡è®°â€æ•´æ•°ç±»å‹ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†ä½ç”¨äºå­˜å‚¨å®é™…çš„æ•´æ•°å€¼ï¼Œè€Œå…¶ä»–ä½åˆ™ç”¨äºæ ‡è®°è¿™ä¸ªæ•°å­—ä¸º SMI ç±»å‹ã€‚
> å…·ä½“çš„å®ç°å¯èƒ½ä¾èµ–äºå…·ä½“çš„å¹³å°å’Œç¯å¢ƒï¼Œä½†åœ¨ä¸€ä¸ªå…¸å‹çš„ 64 ä½ç³»ç»Ÿä¸Šï¼Œä¸€ä¸ª SMI å¯èƒ½ä¼šä½¿ç”¨ 31 ä½æ¥è¡¨ç¤ºæ•´æ•°å€¼ï¼Œè€Œå‰©ä¸‹çš„ä½åˆ™ç”¨äºå…¶ä»–ç›®çš„ï¼Œå¦‚åƒåœ¾æ”¶é›†æ ‡è®°ã€ç±»å‹ä¿¡æ¯ç­‰ã€‚å› ä¸ºä½¿ç”¨äº†è¿™äº›é¢å¤–çš„ä½ï¼Œæ‰€ä»¥ SMI èƒ½è¡¨ç¤ºçš„æ•´æ•°èŒƒå›´ä¼šæ¯”é€šå¸¸çš„ 32 ä½æˆ– 64 ä½æ•´æ•°è¦å°ã€‚

ä»GPTç»™å‡ºçš„å›ç­”æ¥çœ‹ï¼Œä¸€ä¸ªSMIä¼šä½¿ç”¨31ä½æ¥è¡¨ç¤ºæ•´æ•°å€¼ï¼Œå‰©ä½™çš„1ä½åˆ™ç”¨äºå…¶ä»–ç›®çš„ï¼Œé‚£ä¸æ­£å¥½ç›¸å½“äºæ˜¯æ•°æ®å·¦ç§»äº†ä¸€ä½ï¼ä¹Ÿå°±æ˜¯æ–‡ç« å¼€å¤´æåˆ°çš„å†…å­˜è§„å¾‹

ä½†è¿˜é—ç•™äº†ä¸€ä¸ªé—®é¢˜ï¼Œå³node.jsä¸ºä»€ä¹ˆæ²¡æœ‰ç”¨SMIï¼Ÿè‡³å°‘ä»ä¸Šè¿°æµ‹è¯•æ¥çœ‹ï¼Œnode.jså°±æ˜¯ç›´æ¥å­˜çš„ã€‚

GPTå¯¹æ­¤ä¹Ÿæ²¡ç»™å‡ºå¾ˆå¥½çš„å›ç­”ï¼Œ åªèƒ½çŒœæµ‹node.jsèƒŒåå¯¹v8åšäº†ä¸€äº›é­”æ”¹å§ğŸ¤£

 å‚è€ƒ

- [Â How V8 JavaScript engine works step by step [with diagram]Â ](https://cabulous.medium.com/how-v8-javascript-engine-works-5393832d80a7) è¿™ç¯‡å¯ä»¥åŠ æ·±å¯¹v8å¼•æ“çš„ç†è§£ï¼Œæœ‰ä¸°å¯Œçš„æµç¨‹å›¾
- [Â V8 Internals: How Small is a â€œSmall Integer?â€Â ](https://medium.com/fhinkel/v8-internals-how-small-is-a-small-integer-e0badc18b6da) ç†è§£smi



[]()